---
title: "Comprehensive Financial Time Series Analysis"
subtitle: "A Study of AAPL Stock and Air Passenger Data"
author: "Shreyas Sunil"
date: "August 7, 2025"
output:
  html_document:
    self_contained: true
    toc: true
    toc_float: true
    theme: united
    highlight: tango
---

```{r setup, include=FALSE}
# This chunk sets up the global options for all subsequent code chunks.
# echo = FALSE: By default, don't show the R code in the final report. We will override this where needed.
# message = FALSE: Suppress any messages generated by packages.
# warning = FALSE: Suppress any warnings.
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.align = 'center')

# Load all necessary libraries for the analysis
library(quantmod)
library(xts)
library(tseries)
library(moments)
library(forecast)
library(ggplot2)
```

# Introduction

This report presents a detailed time series analysis covering two distinct datasets. First, we analyze the daily stock returns of Apple Inc. (AAPL) to understand its statistical properties, volatility, and mean structure. Second, we explore forecasting techniques on the classic `AirPassengers` dataset, which exhibits strong trend and seasonality, comparing Exponential Smoothing methods with Seasonal ARIMA models.

# Part 1: Analysis of Apple Inc. (AAPL) Stock Data

In this section, we download historical stock price data for AAPL and perform a comprehensive analysis of its log returns. The goal is to identify key "stylized facts" of financial returns, such as volatility clustering and non-normality, and to model the mean return structure.

## 1.1 Data Acquisition and Transformation

We begin by downloading daily AAPL stock data from Yahoo Finance and calculating the continuously compounded (log) returns, which are standard for financial modeling.

```{r aapl_data_prep, echo=TRUE}
# Define the stock ticker and the start date for our data
ticker <- "AAPL"
start_date <- "2010-01-01"

# Download the data using quantmod
getSymbols(ticker, src = "yahoo", from = start_date, auto.assign = TRUE)

# Extract the Adjusted Close price, which accounts for dividends and splits
aapl_prices <- Ad(AAPL)

# Compute daily log returns
aapl_log_returns <- diff(log(aapl_prices))
aapl_log_returns <- na.omit(aapl_log_returns) # Remove the first NA value
```

The analysis is performed on `r NROW(aapl_log_returns)` daily log returns from `r format(start(aapl_log_returns), "%Y-%m-%d")` to `r format(end(aapl_log_returns), "%Y-%m-%d")`.

## 1.2 Visualizing Price and Returns

A visual inspection of the price and returns series reveals important characteristics. The price series shows a clear upward trend, indicating non-stationarity. The log returns, however, appear to be stationary around a mean close to zero but exhibit periods of high and low volatility, a phenomenon known as **volatility clustering**.

```{r aapl_visuals, fig.cap="Figure 1: AAPL Price and Return Series."}
# Set layout for multiple plots
par(mfrow = c(3, 1), mar = c(4, 4, 2, 1))

# Plot 1: Adjusted Close Price
plot(aapl_prices, main = "AAPL Adjusted Close Price", col = "steelblue")

# Plot 2: Daily Log Returns
plot(aapl_log_returns, main = "AAPL Daily Log Returns", col = "darkred")

# Plot 3: Squared Log Returns to emphasize volatility
plot(aapl_log_returns^2, main = "AAPL Squared Daily Log Returns (Volatility Proxy)", col = "darkgreen")

# Reset plotting layout
par(mfrow = c(1, 1))
```

## 1.3 Statistical Properties of Returns

We now examine the statistical properties of the log returns to test for normality and quantify their distribution.

```{r aapl_stats_test}
# Calculate key statistics
mean_return <- mean(aapl_log_returns)
sd_return <- sd(aapl_log_returns)
skewness_return <- skewness(aapl_log_returns)
kurtosis_return <- kurtosis(aapl_log_returns)

# Perform the Jarque-Bera test for normality
jb_test <- jarque.bera.test(aapl_log_returns)

# Print results
cat("--- Key Statistics of AAPL Log Returns ---\n")
cat("Mean Log Return:", round(mean_return, 6), "\n")
cat("Std. Deviation (Volatility):", round(sd_return, 6), "\n")
cat("Skewness:", round(skewness_return, 4), "\n")
cat("Kurtosis:", round(kurtosis_return, 4), "(A normal distribution has Kurtosis of 3)\n")
cat("Excess Kurtosis:", round(kurtosis_return - 3, 4), "\n\n")

cat("--- Jarque-Bera Normality Test ---\n")
print(jb_test)
```

The results show a mean close to zero, negative skewness, and high kurtosis (leptokurtosis or "fat tails"). The Jarque-Bera test strongly rejects the null hypothesis of normality, which is typical for financial returns.

### Visualizing the Return Distribution

To further illustrate the non-normality, we plot a histogram of the returns against a theoretical normal curve and create a Normal Q-Q plot. The Q-Q plot's deviations from the reference line at the tails are clear visual evidence of fat tails.

```{r aapl_distribution_plots, fig.cap="Figure 2: Distribution of AAPL Log Returns."}
par(mfrow = c(1, 2))

# Histogram with Normal Curve
hist(aapl_log_returns, breaks = 50, freq = FALSE, 
     main = "Histogram of AAPL Returns", xlab = "Log Return", col = "lightblue")
curve(dnorm(x, mean = mean(aapl_log_returns), sd = sd(aapl_log_returns)), 
      add = TRUE, col = "red", lwd = 2)

# Q-Q Plot
qqnorm(aapl_log_returns, main = "Normal Q-Q Plot")
qqline(aapl_log_returns, col = "red", lwd = 2)

par(mfrow = c(1, 1))
```

## 1.4 Autocorrelation Structure and Mean Modeling

We analyze the Autocorrelation Function (ACF) and Partial Autocorrelation Function (PACF) to identify the structure for an ARMA model.

### ACF/PACF of Price vs. Returns

First, we confirm the non-stationarity of the price series, which shows a very slow-decaying ACF. In contrast, the log return series appears to be white noise, with no significant autocorrelation after lag 0.

```{r aapl_acf_pacf, fig.cap="Figure 3: ACF/PACF of Price and Return Series."}
par(mfrow = c(2, 2), mar = c(4, 4, 2, 1))

# For Price Series (Non-Stationary)
acf(aapl_prices, main = "ACF of AAPL Price")
pacf(aapl_prices, main = "PACF of AAPL Price")

# For Log Return Series (Stationary)
acf(aapl_log_returns, main = "ACF of Log Returns")
pacf(aapl_log_returns, main = "PACF of Log Returns")

par(mfrow = c(1, 1))
```

### Fitting ARMA Models

Based on the ACF/PACF of the returns, we hypothesize that a simple model is sufficient. We fit an ARMA(0,0) (white noise), AR(1), and MA(1) model and check their residuals.

```{r aapl_arma_fit}
# Fit models
fit_wn <- arima(aapl_log_returns, order = c(0, 0, 0))
fit_ar1 <- arima(aapl_log_returns, order = c(1, 0, 0))
fit_ma1 <- arima(aapl_log_returns, order = c(0, 0, 1))

# Ljung-Box test for residuals
lb_wn <- Box.test(residuals(fit_wn), type = "Ljung-Box")
lb_ar1 <- Box.test(residuals(fit_ar1), type = "Ljung-Box")
lb_ma1 <- Box.test(residuals(fit_ma1), type = "Ljung-Box")

cat("--- Ljung-Box Test on Model Residuals ---\n")
cat("ARMA(0,0) p-value:", lb_wn$p.value, "\n")
cat("AR(1) p-value:    ", lb_ar1$p.value, "\n")
cat("MA(1) p-value:    ", lb_ma1$p.value, "\n")
```

The Ljung-Box test shows a low p-value for the white noise model, indicating some remaining autocorrelation. Both the AR(1) and MA(1) models have high p-values, suggesting their residuals are free of autocorrelation and are thus adequate models for the mean.

## 1.5 Long Memory in Volatility

Finally, we test for long memory in volatility by examining the ACF of the squared returns. The slow, hyperbolic decay suggests that shocks to volatility are very persistent.

```{r aapl_long_memory, fig.cap="Figure 4: ACF of Squared Returns, showing long memory."}
aapl_sq_returns <- aapl_log_returns^2
acf(aapl_sq_returns, main = "ACF of AAPL Squared Returns (Volatility)", lag.max = 100)
```

# Part 2: Forecasting with Trend and Seasonality

We now switch to the `AirPassengers` dataset, a classic time series that exhibits a strong upward trend and a clear 12-month seasonal pattern.

```{r air_pass_data, fig.cap="Figure 5: Monthly Airline Passengers."}
# Load and plot the data
data("AirPassengers")
AP <- AirPassengers
plot(AP, main = "Monthly Airline Passengers 1949-1960", 
     ylab = "Passengers (thousands)", col = "darkblue")
```

## 2.1 Exponential Smoothing Methods

We compare three types of exponential smoothing to see how they handle the data's components.
- **Simple Exponential Smoothing (SES):** Captures only the level.
- **Holt's Method:** Captures level and trend.
- **Holt-Winters Method:** Captures level, trend, and seasonality.

```{r air_pass_es, fig.cap="Figure 6: Forecasts from Exponential Smoothing Models."}
# Fit models
ses_fit <- HoltWinters(AP, beta = FALSE, gamma = FALSE)
holt_fit <- HoltWinters(AP, gamma = FALSE)
hw_fit <- HoltWinters(AP, seasonal = "multiplicative")

# Generate forecasts
ses_forecast <- forecast(ses_fit, h = 60)
holt_forecast <- forecast(holt_fit, h = 60)
hw_forecast <- forecast(hw_fit, h = 60)

# Plot the forecasts
plot(hw_forecast, main = "Exponential Smoothing Forecasts", 
     ylab = "Passengers (thousands)", fcol = "blue", flwd = 2)
lines(holt_forecast$mean, col = "red", lwd = 2)
lines(ses_forecast$mean, col = "darkgreen", lwd = 2)
legend("topleft", 
       legend = c("Holt-Winters", "Holt's (Trend)", "SES (Level only)"),
       col = c("blue", "red", "darkgreen"), lwd = 2, bty = "n")
```

As expected, the Holt-Winters method, which accounts for both trend and multiplicative seasonality, provides a vastly superior fit and a more realistic forecast.

## 2.2 Seasonal ARIMA (SARIMA) Modeling

We use the `auto.arima()` function to automatically find the best Seasonal ARIMA model for the data. This automates the process of differencing and selecting AR/MA terms.

```{r air_pass_sarima, echo=TRUE}
# Find the best SARIMA model automatically
# We set trace=FALSE for a cleaner report output
sarima_fit <- auto.arima(AP, trace = FALSE, stepwise = FALSE, approximation = FALSE)

# Print the summary of the best model found
summary(sarima_fit)
```

### SARIMA Residuals and Forecast

We check the residuals of the selected model to ensure they are white noise, and then generate a forecast.

```{r air_pass_sarima_results, fig.cap="Figure 7: SARIMA Residuals and Forecast."}
# Check residuals
checkresiduals(sarima_fit)

# Generate and plot forecast
sarima_forecast <- forecast(sarima_fit, h = 60)
plot(sarima_forecast, main = "Forecast from auto.arima (SARIMA)",
     ylab = "Passengers (thousands)")
```

The residual diagnostics indicate a good model fit, and the SARIMA forecast effectively captures the trend and seasonal patterns, producing results visually similar to the Holt-Winters method.

# Conclusion

This report demonstrated key techniques in financial time series analysis. We showed that AAPL returns are not normally distributed, exhibit volatility clustering, and have long memory in their volatility. We also successfully modeled a time series with strong trend and seasonality using both Holt-Winters and SARIMA methods, highlighting the importance of choosing a model that can account for the underlying structure of the data.